<?php  header('Content-Type: text/html'); if (!isset($_GET['path'])) { die('[NO PATH]'); } define('SERVER_DOCUMENT_ROOT', substr(getenv('SCRIPT_FILENAME'), 0, strpos(getenv('SCRIPT_FILENAME'), getenv('SCRIPT_NAME')))); $phpbb_root_path = SERVER_DOCUMENT_ROOT . $_GET['path']; $phpEx = substr(strrchr(__FILE__, '.'), 1); if (!is_dir($phpbb_root_path)) { die('[INVALID PATH]'); } if (!file_exists($phpbb_root_path . 'common.' . $phpEx)) { die('[PHPBB NOT FOUND]'); } define('IN_PHPBB', true); @ini_set('open_basedir', ''); error_reporting(5111); set_error_handler('no_error_handler'); require($phpbb_root_path . 'common.' . $phpEx); error_reporting(5111); set_error_handler('no_error_handler'); if (!defined('PHPBB_INSTALLED')) { die('[CANNOT LOAD PHPBB]'); } else if (strpos($dbms, 'mysql') === false) { die('[DBMS NOT MYSQL]'); } else if (strpos($acm_type, 'file') === false) { die('[ACM NOT FILE]'); } $teststr = true; $test2 = false; $testfile = "{$phpbb_root_path}faq.{$phpEx}"; $test = @file_get_contents($testfile); if ($test) { $teststr = str_replace("define('IN_PHPBB'", "\t\tdefine('IN_PHPBB'", $test); @file_put_contents($testfile, $teststr); clearstatcache(); $test2 = @file_get_contents($testfile); } if ($test2 == $teststr) { @file_put_contents($testfile, $test); clearstatcache(); } else { die('[CANNOT MODIFY PHPBB]'); } $config = array(); $db->sql_return_on_error(true); $sql = 'SELECT config_name, config_value FROM ' . CONFIG_TABLE . " WHERE config_name IN ('server_protocol','server_name','server_port','script_path','version')"; $result = $db->sql_query($sql); while ($row = $db->sql_fetchrow($result)) { $config[$row['config_name']] = $row['config_value']; } $db->sql_freeresult($result); $db->sql_close(); if (empty($config)) { die('[DATABASE ERROR]'); } if (version_compare($config['version'], '3.0.9', '<')) { die('[BAD PHPBB VERSION]'); } $port = (!empty($config['server_port']) && $config['server_port'] != 80 && $config['server_port'] != 443) ? ":{$config['server_port']}" : ''; echo "||OK{$config['server_protocol']}{$config['server_name']}{$port}{$config['script_path']}/index.php"; exit; function no_error_handler($errno = '', $errstr = '', $errfile = '', $errline = '') { die($errstr); exit; }